#! bash

# Sets up the shell for interactive commands

# Use the terminfo backspace character as the erase character. This is not
# enabled by default because terminfo is often broken.
#stty erase $(tput kbs)

# Prompt: user@host:(chroot)directory$
PS1='${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '

# Check for unsupported TERM variable
if ! tput init &> /dev/null; then
	echo "Warning! TERM=$TERM unsupported, using TERM=xterm"
	export TERM=xterm
fi

# The all important colours!
ssource "${HOME}/.bash/colors"

# xterm titlebar displays 'hostname:workingdir'
if tput hs || tput tsl &> /dev/null; then
	PROMPT_COMMAND='tput tsl; echo -n "$(hostname| cut -d. -f1):${PWD/$HOME/~}"; tput fsl;'
fi

# screen window displays current command
case "${TERM}" in
screen*)
	PROMPT_COMMAND="$PROMPT_COMMAND echo -ne '\033k\033\\'"
	;;
esac

# Useful aliases
alias ls='ls --color=auto'
alias ll='ls -hlF'
alias la='ls -ha'
alias  l='ls -halF'
alias ld='ls -ld'
alias f='find . -iname'
alias webshare='python -c "import SimpleHTTPServer; SimpleHTTPServer.test()"'
alias rm='rm -i'
alias less='less -R'
alias grep='grep --color=auto'

# Bash should check the terminal size after every command terminates
shopt -s checkwinsize
# Don't attempt to tab-complete an empty line
shopt -s no_empty_cmd_completion

# Local customisations
ssource "${HOME}/.bash/interactive_local"

# Load bash completion if available
ssource "/etc/bash_completion"

# This is designed to be annoying enough for me to actually commit any changes
# I have made.
HGDOTFILES="$(readlink ~/.bash)/.."
if [ ! -z "$(which hg 2>/dev/null)" ]; then
	pushd "$HOME" >/dev/null
	cd "$HGDOTFILES"
	hgdotchanges="$(hg status --modified --added --removed --deleted --no-status)" 2>/dev/null
	if [ ! -z "$hgdotchanges" ]; then
		echo "WARNING: There are uncommited dotfile changes, to the following files:" >&2
		echo "$hgdotchanges" >&2
	fi
	popd >/dev/null
fi
unset HGDOTFILES hgdotchanges
